/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
!function(){function e(e,t,n){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(n,t,"block_processed",!0),e.push(t))}function t(t,n){function l(e){for(var t,n=new CKEDITOR.dom.elementPath(e).elements,l=0;l<n.length;l++)if(n[l].getName()in m){t=n[l];break}return t}function i(){this.foreach(function(e){/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(t){e.setValue(t.getAttribute(e.id)||"")}),e.commit||(e.commit=function(t){var n=this.getValue();("dir"!=e.id||t.getComputedStyle("direction")!=n)&&(n?t.setAttribute(e.id,n):t.removeAttribute(e.id))}))})}function o(t){var n,l,i,o=[],a={},d=[],c=t.document.getSelection(),u=c.getRanges(),g=c.createBookmarks();for(t.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p",l=0;l<u.length;l++)for(i=u[l].createIterator();n=i.getNextParagraph();)if(n.getName()in m){var h,f=n.getChildren();for(h=0;h<f.count();h++)e(d,f.getItem(h),a)}else{for(;!s[n.getName()]&&"body"!=n.getName();)n=n.getParent();e(d,n,a)}CKEDITOR.dom.element.clearAllMarkers(a);var v,b,p=r(d);for(l=0;l<p.length;l++){var y=p[l][0];for(v=y.getParent(),h=1;h<p[l].length;h++)v=v.getCommonAncestor(p[l][h]);for(b=new CKEDITOR.dom.element("div",t.document),h=0;h<p[l].length;h++){for(y=p[l][h];!y.getParent().equals(v);)y=y.getParent();p[l][h]=y}for(h=0;h<p[l].length;h++)y=p[l][h],y.getCustomData&&y.getCustomData("block_processed")||(y.is&&CKEDITOR.dom.element.setMarker(a,y,"block_processed",!0),h||b.insertBefore(y),b.append(y));CKEDITOR.dom.element.clearAllMarkers(a),o.push(b)}return c.selectBookmarks(g),o}function a(e){var t=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),n=t.blockLimit,l=n&&n.getAscendant("div",!0);return l}function r(e){for(var t,n=[],i=null,o=0;o<e.length;o++){t=e[o];var a=l(t);a.equals(i)||(i=a,n.push([])),n[n.length-1].push(t)}return n}function d(e){var n=this.getDialog(),l=n._element&&n._element.clone()||new CKEDITOR.dom.element("div",t.document);this.commit(l,!0),e=[].concat(e);for(var i,o=e.length,a=0;o>a;a++)i=n.getContentElement.apply(n,e[a].split(":")),i&&i.setup&&i.setup(l,!0)}var m=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return delete e.div,t.config.div_wrapTable&&(delete e.td,delete e.th),e}(),s=CKEDITOR.dtd.div,c={},u=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[[t.lang.common.notSet,""]],onChange:function(){d.call(this,["info:class","advanced:dir","advanced:style"])},setup:function(e){for(var t in c)c[t].checkElementRemovable(e,!0)&&this.setValue(t)},commit:function(e){var t;if(t=this.getValue()){var n=c[t],l=e.getCustomData("elementStyle")||"";n.applyToObject(e),e.setCustomData("elementStyle",l+n._.definition.attributes.style)}}},{id:"class",type:"text",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:t.lang.common.id,"default":""},{type:"text",id:"lang",label:t.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:t.lang.common.cssStyle,"default":"",commit:function(e){var t=this.getValue()+(e.getCustomData("elementStyle")||"");e.setAttribute("style",t)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.notSet,""],[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){i.call(this);var e=this,n=this.getContentElement("info","elementStyle");t.getStylesSet(function(t){var l;if(t)for(var i=0;i<t.length;i++){var o=t[i];o.element&&"div"==o.element&&(l=o.name,c[l]=new CKEDITOR.style(o),n.items.push([l,l]),n.add(l,l))}n[n.items.length>1?"enable":"disable"](),setTimeout(function(){n.setup(e._element)},0)})},onShow:function(){if("editdiv"==n){var e=a(t);e&&this.setupContent(this._element=e)}},onOk:function(){u="editdiv"==n?[this._element]:o(t,!0);for(var e=u.length,l=0;e>l;l++)this.commitContent(u[l]),!u[l].getAttribute("style")&&u[l].removeAttribute("style");this.hide()},onHide:function(){"editdiv"==n&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(e){return t(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return t(e,"editdiv")})}();