/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
!function(){function e(e){var t,r,l,n,i=e.children,a=e.children.length,s=/list-style-type:(.*?)(?:;|$)/,o=CKEDITOR.plugins.pastefromword.filters.stylesFilter;if(r=e.attributes,!s.exec(r.style)){for(var u=0;a>u;u++)if(t=i[u],t.attributes.value&&Number(t.attributes.value)==u+1&&delete t.attributes.value,l=s.exec(t.attributes.style)){if(l[1]!=n&&n){n=null;break}n=l[1]}if(n){for(u=0;a>u;u++)r=i[u].attributes,r.style&&(r.style=o([["list-style-type"]])(r.style)||"");e.addStyle("list-style-type",n)}}}function t(e){e=e.toUpperCase();for(var t=h.length,r=0,l=0;t>l;++l)for(var n=h[l],i=n[1].length;e.substr(0,i)==n[1];e=e.substr(i))r+=n[0];return r}function r(e){e=e.toUpperCase();for(var t=p.length,r=1,l=1;e.length>0;l*=t)r+=p.indexOf(e.charAt(e.length-1))*l,e=e.substr(0,e.length-1);return r}var l=CKEDITOR.htmlParser.fragment.prototype,n=CKEDITOR.htmlParser.element.prototype;l.onlyChild=n.onlyChild=function(){var e=this.children,t=e.length,r=1==t&&e[0];return r||null},n.removeAnyChildWithName=function(e){for(var t,r=this.children,l=[],n=0;n<r.length;n++)t=r[n],t.name&&(t.name==e&&(l.push(t),r.splice(n--,1)),l=l.concat(t.removeAnyChildWithName(e)));return l},n.getAncestor=function(e){for(var t=this.parent;t&&(!t.name||!t.name.match(e));)t=t.parent;return t},l.firstChild=n.firstChild=function(e){for(var t,r=0;r<this.children.length;r++){if(t=this.children[r],e(t))return t;if(t.name&&(t=t.firstChild(e)))return t}return null},n.addStyle=function(e,t,r){var l,n=this,i="";if("string"==typeof t)i+=e+":"+t+";";else{if("object"==typeof e)for(var a in e)e.hasOwnProperty(a)&&(i+=a+":"+e[a]+";");else i+=e;r=t}n.attributes||(n.attributes={}),l=n.attributes.style||"",l=(r?[i,l]:[l,i]).join(";"),n.attributes.style=l.replace(/^;|;(?=;)/,"")},CKEDITOR.dtd.parentOf=function(e){var t={};for(var r in this)-1==r.indexOf("$")&&this[r][e]&&(t[r]=1);return t};var i,a=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,s=/^(?:\b0[^\s]*\s*){1,4}$/,o="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",u=new RegExp(o),c=new RegExp(o.toUpperCase()),f={decimal:/\d+/,"lower-roman":u,"upper-roman":c,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},d={disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/},m={ol:f,ul:d},h=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],p="ABCDEFGHIJKLMNOPQRSTUVWXYZ",y=0,v=null,g=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(e,t){var r=new CKEDITOR.htmlParser.element("cke:listbullet");return r.attributes={"cke:listsymbol":e[0]},r.add(new CKEDITOR.htmlParser.text(t)),r},isListBulletIndicator:function(e){var t=e.attributes&&e.attributes.style;return/mso-list\s*:\s*Ignore/i.test(t)?!0:void 0},isContainingOnlySpaces:function(e){var t;return(t=e.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(t.value)},resolveList:function(e){var t,r=e.attributes;return(t=e.removeAnyChildWithName("cke:listbullet"))&&t.length&&(t=t[0])?(e.name="cke:li",r.style&&(r.style=g.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(e){var t=e.split(" ");e=CKEDITOR.tools.convertToPx(t[3]||t[1]||t[0]),!y&&null!==v&&e>v&&(y=e-v),v=e,r["cke:indent"]=y&&Math.ceil(e/y)+1||1}],[/^mso-list$/,null,function(e){e=e.split(" ");var t=Number(e[0].match(/\d+/)),l=Number(e[1].match(/\d+/));1==l&&(t!==i&&(r["cke:reset"]=1),i=t),r["cke:indent"]=l}]])(r.style,e)||""),r["cke:indent"]||(v=0,r["cke:indent"]=1),CKEDITOR.tools.extend(r,t.attributes),!0):(i=v=y=null,!1)},getStyleComponents:function(){var e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);return CKEDITOR.document.getBody().append(e),function(t,r,l){e.setStyle(t,r);for(var n={},i=l.length,a=0;i>a;a++)n[l[a]]=e.getStyle(l[a]);return n}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(e,t){t="number"==typeof t?t:1;var r,l=e.attributes;switch(l.type){case"a":r="lower-alpha";break;case"1":r="decimal"}for(var n,s=e.children,o=0;o<s.length;o++)if(n=s[o],n.name in CKEDITOR.dtd.$listItem){var u=n.attributes,c=n.children,f=c.length,d=c[f-1];d.name in CKEDITOR.dtd.$list&&(e.add(d,o+1),--c.length||s.splice(o--,1)),n.name="cke:li",l.start&&!o&&(u.value=l.start),g.filters.stylesFilter([["tab-stops",null,function(e){var t=e.split(" ")[1].match(a);t&&(v=CKEDITOR.tools.convertToPx(t[0]))}],1==t?["mso-list",null,function(e){e=e.split(" ");var t=Number(e[0].match(/\d+/));t!==i&&(u["cke:reset"]=1),i=t}]:null])(u.style),u["cke:indent"]=t,u["cke:listtype"]=e.name,u["cke:list-style-type"]=r}else if(n.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[n,t+1]),s=s.slice(0,o).concat(n.children).concat(s.slice(o+1)),e.children=[];for(var m=0,h=s.length;h>m;m++)e.add(s[m])}delete e.name,l["cke:list"]=1},assembleList:function(l){for(var n,a,s,o,u,c,f,d,h,p,g,b,C,O=l.children,R=[],E=0;E<O.length;E++)if(n=O[E],"cke:li"==n.name){if(n.name="li",a=n,s=a.attributes,p=s["cke:listsymbol"],p=p&&p.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),g=b=C=null,s["cke:ignored"]){O.splice(E--,1);continue}if(s["cke:reset"]&&(f=u=c=null),o=Number(s["cke:indent"]),o!=u&&(h=d=null),p){if(h&&m[h][d].test(p[1]))g=h,b=d;else for(var I in m)for(var T in m[I])if(m[I][T].test(p[1])){if("ol"!=I||!/alpha|roman/.test(T)){g=I,b=T;break}var D=/roman/.test(T)?t(p[1]):r(p[1]);(!C||C>D)&&(C=D,g=I,b=T)}!g&&(g=p[2]?"ol":"ul")}else g=s["cke:listtype"]||"ol",b=s["cke:list-style-type"];if(h=g,d=b||("ol"==g?"decimal":"disc"),b&&b!=("ol"==g?"decimal":"disc")&&a.addStyle("list-style-type",b),"ol"==g&&p){switch(b){case"decimal":C=Number(p[1]);break;case"lower-roman":case"upper-roman":C=t(p[1]);break;case"lower-alpha":case"upper-alpha":C=r(p[1])}a.attributes.value=C}if(f){if(o>u)R.push(f=new CKEDITOR.htmlParser.element(g)),f.add(a),c.add(f);else if(u>o){for(var K,k=u-o;k--&&(K=f.parent);)f=K.parent;f.add(a)}else f.add(a);O.splice(E--,1)}else R.push(f=new CKEDITOR.htmlParser.element(g)),f.add(a),O[E]=f;c=a,u=o}else f&&(f=u=c=null);for(E=0;E<R.length;E++)e(R[E]);f=u=c=i=v=y=null},falsyFilter:function(){return!1},stylesFilter:function(e,t){return function(r,l){var n=[];(r||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(r,i,a){i=i.toLowerCase(),"font-family"==i&&(a=a.replace(/["']/g,""));for(var s,o,u,c,f=0;f<e.length;f++)if(e[f]&&(s=e[f][0],o=e[f][1],u=e[f][2],c=e[f][3],i.match(s)&&(!o||a.match(o))))return i=c||i,t&&(u=u||a),"function"==typeof u&&(u=u(a,l,i)),u&&u.push&&(i=u[0],u=u[1]),"string"==typeof u&&n.push([i,u]),void 0;!t&&n.push([i,a])});for(var i=0;i<n.length;i++)n[i]=n[i].join(":");return n.length?n.join(";")+";":!1}},elementMigrateFilter:function(e,t){return function(r){var l=t?new CKEDITOR.style(e,t)._.definition:e;r.name=l.element,CKEDITOR.tools.extend(r.attributes,CKEDITOR.tools.clone(l.attributes)),r.addStyle(CKEDITOR.style.getStyleText(l))}},styleMigrateFilter:function(e,t){var r=this.elementMigrateFilter;return function(l,n){var i=new CKEDITOR.htmlParser.element(null),a={};a[t]=l,r(e,a)(i),i.children=n.children,n.children=[i]}},bogusAttrFilter:function(e,t){return-1==t.name.indexOf("cke:")?!1:void 0},applyStyleFilter:null},getRules:function(e){var t=CKEDITOR.dtd,r=CKEDITOR.tools.extend({},t.$block,t.$listItem,t.$tableContent),l=e.config,n=this.filters,i=n.falsyFilter,a=n.stylesFilter,o=n.elementMigrateFilter,u=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),c=this.utils.createListBulletMarker,f=n.flattenList,d=n.assembleList,m=this.utils.isListBulletIndicator,h=this.utils.isContainingOnlySpaces,p=this.utils.resolveList,y=function(e){return e=CKEDITOR.tools.convertToPx(e),isNaN(e)?e:e+"px"},v=this.utils.getStyleComponents,g=this.utils.listDtdParents,b=l.pasteFromWordRemoveFontStyles!==!1,C=l.pasteFromWordRemoveStyles!==!1;return{elementNames:[[/meta|link|script/,""]],root:function(e){e.filterChildren(),d(e)},elements:{"^":function(e){var t;CKEDITOR.env.gecko&&(t=n.applyStyleFilter)&&t(e)},$:function(e){var n=e.name||"",i=e.attributes;if(n in r&&i.style&&(i.style=a([[/^(:?width|height)$/,null,y]])(i.style)||""),n.match(/h\d/)){if(e.filterChildren(),p(e))return;o(l["format_"+n])(e)}else if(n in t.$inline)e.filterChildren(),h(e)&&delete e.name;else if(-1!=n.indexOf(":")&&-1==n.indexOf("cke")){if(e.filterChildren(),"v:imagedata"==n){var s=e.attributes["o:href"];return s&&(e.attributes.src=s),e.name="img",void 0}delete e.name}n in g&&(e.filterChildren(),d(e))},style:function(e){if(CKEDITOR.env.gecko){var t=e.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),r=t&&t[1],l={};r&&(r.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(e,t,r){t=t.split(",");for(var n=t.length,i=0;n>i;i++)CKEDITOR.tools.trim(t[i]).replace(/^(\w+)(\.[\w-]+)?$/g,function(e,t,n){t=t||"*",n=n.substring(1,n.length),n.match(/MsoNormal/)||(l[t]||(l[t]={}),n?l[t][n]=r:l[t]=r)})}),n.applyStyleFilter=function(e){var t,r=l["*"]?"*":e.name,n=e.attributes&&e.attributes["class"];r in l&&(t=l[r],"object"==typeof t&&(t=t[n]),t&&e.addStyle(t,!0))})}return!1},p:function(e){if(/MsoListParagraph/.exec(e.attributes["class"])){var t=e.firstChild(function(e){return e.type==CKEDITOR.NODE_TEXT&&!h(e.parent)}),r=t&&t.parent,n=r&&r.attributes;n&&!n.style&&(n.style="mso-list: Ignore;")}e.filterChildren(),p(e)||(l.enterMode==CKEDITOR.ENTER_BR?(delete e.name,e.add(new CKEDITOR.htmlParser.element("br"))):o(l["format_"+(l.enterMode==CKEDITOR.ENTER_P?"p":"div")])(e))},div:function(e){var t=e.onlyChild();if(t&&"table"==t.name){var r=e.attributes;t.attributes=CKEDITOR.tools.extend(t.attributes,r),r.style&&t.addStyle(r.style);var l=new CKEDITOR.htmlParser.element("div");l.addStyle("clear","both"),e.add(l),delete e.name}},td:function(e){e.getAncestor("thead")&&(e.name="th")},ol:f,ul:f,dl:f,font:function(e){if(m(e.parent))return delete e.name,void 0;e.filterChildren();var t=e.attributes,r=t.style,l=e.parent;"font"==l.name?(CKEDITOR.tools.extend(l.attributes,e.attributes),r&&l.addStyle(r),delete e.name):(r=r||"",t.color&&("#000000"!=t.color&&(r+="color:"+t.color+";"),delete t.color),t.face&&(r+="font-family:"+t.face+";",delete t.face),t.size&&(r+="font-size:"+(t.size>3?"large":t.size<3?"small":"medium")+";",delete t.size),e.name="span",e.addStyle(r))},span:function(e){if(m(e.parent))return!1;if(e.filterChildren(),h(e))return delete e.name,null;if(m(e)){var t=e.firstChild(function(e){return e.value||"img"==e.name}),r=t&&(t.value||"l."),n=r&&r.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(n){var i=c(n,r),s=e.getAncestor("span");return s&&/ mso-hide:\s*all|display:\s*none /.test(s.attributes.style)&&(i.attributes["cke:ignored"]=1),i}}var o=e.children,f=e.attributes,d=f&&f.style;return o&&o[0],d&&(f.style=a([["line-height"],[/^font-family$/,null,b?null:u(l.font_style,"family")],[/^font-size$/,null,b?null:u(l.fontSize_style,"size")],[/^color$/,null,b?null:u(l.colorButton_foreStyle,"color")],[/^background-color$/,null,b?null:u(l.colorButton_backStyle,"color")]])(d,e)||""),null},b:o(l.coreStyles_bold),i:o(l.coreStyles_italic),u:o(l.coreStyles_underline),s:o(l.coreStyles_strike),sup:o(l.coreStyles_superscript),sub:o(l.coreStyles_subscript),a:function(e){var t=e.attributes;t&&!t.href&&t.name?delete e.name:CKEDITOR.env.webkit&&t.href&&t.href.match(/file:\/\/\/[\S]+#/i)&&(t.href=t.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(e){e.getAncestor(/h\d/)&&!l.pasteFromWordNumberedHeadingToList&&delete e.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:a(C?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(e,t,r){if(t.name in{p:1,div:1}){var n="ltr"==l.contentsLangDirection?"margin-left":"margin-right";if("margin"==r)e=v(r,e,[n])[n];else if(r!=n)return null;if(e&&!s.test(e))return[n,e]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(e,t){return"img"==t.name?e:void 0}],[/^width|height$/,null,function(e,t){return t.name in{table:1,td:1,th:1,img:1}?e:void 0}]]:[[/^mso-/],[/-color$/,null,function(e){return"transparent"==e?!1:CKEDITOR.env.gecko?e.replace(/-moz-use-text-color/g,"transparent"):void 0}],[/^margin$/,s],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],b?[/font-?/]:null],C),width:function(e,r){return r.name in t.$tableContent?!1:void 0},border:function(e,r){return r.name in t.$tableContent?!1:void 0},"class":i,bgcolor:i,valign:C?i:function(e,t){return t.addStyle("vertical-align",e),!1}},comment:CKEDITOR.env.ie?i:function(e,t){var r=e.match(/<img.*?>/),l=e.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(l){var n=l[1]||r&&"l.",i=n&&n.match(/>(?:[(]?)([^\s]+?)([.)]?)</);return c(i,n)}if(CKEDITOR.env.gecko&&r){var a=CKEDITOR.htmlParser.fragment.fromHtml(r[0]).children[0],s=t.previous,o=s&&s.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),u=o&&o[1];return u&&(a.attributes.src=u),a}return!1}}}},b=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};b.prototype={toHtml:function(e){var t=CKEDITOR.htmlParser.fragment.fromHtml(e,!1),r=new CKEDITOR.htmlParser.basicWriter;return t.writeHtml(r,this.dataFilter),r.getHtml(!0)}},CKEDITOR.cleanWord=function(e,t){CKEDITOR.env.gecko&&(e=e.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3"));var r=new b,l=r.dataFilter;l.addRules(CKEDITOR.plugins.pastefromword.getRules(t)),t.fire("beforeCleanWord",{filter:l});try{e=r.toHtml(e,!1)}catch(n){alert(t.lang.pastefromword.error)}return e=e.replace(/cke:.*?".*?"/g,""),e=e.replace(/style=""/g,""),e=e.replace(/<span>/g,"")}}();