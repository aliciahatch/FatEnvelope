/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
!function(){CKEDITOR.document,CKEDITOR.dialog.add("templates",function(e){function t(e,t){e.setHtml("");for(var s=0,l=t.length;l>s;s++)for(var i=CKEDITOR.getTemplates(t[s]),n=i.imagesPath,o=i.templates,c=o.length,p=0;c>p;p++){var r=o[p],d=a(r,n);d.setAttribute("aria-posinset",p+1),d.setAttribute("aria-setsize",c),e.append(d)}}function a(e,t){var a=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),l='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';return e.image&&t&&(l+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(t+e.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'),l+='<td style="white-space:normal;"><span class="cke_tpl_title">'+e.title+"</span><br/>",e.description&&(l+="<span>"+e.description+"</span>"),l+="</td></tr></table>",a.getFirst().setHtml(l),a.on("click",function(){s(e.html)}),a}function s(t){var a=CKEDITOR.dialog.getCurrent(),s=a.getValueOf("selectTpl","chkInsertOpt");s?(e.on("contentDom",function(t){t.removeListener(),a.hide();var s=new CKEDITOR.dom.range(e.document);s.moveToElementEditStart(e.document.getBody()),s.select(1),setTimeout(function(){e.fire("saveSnapshot")},0)}),e.fire("saveSnapshot"),e.setData(t)):(e.insertHtml(t),a.hide())}function l(e){var t=e.data.getTarget(),a=i.equals(t);if(a||i.contains(t)){var s,l=e.data.getKeystroke(),n=i.getElementsByTag("a");if(n){if(a)s=n.getItem(0);else switch(l){case 40:s=t.getNext();break;case 38:s=t.getPrevious();break;case 13:case 32:t.fire("click")}s&&(s.focus(),e.data.preventDefault())}}}CKEDITOR.skins.load(e,"templates");var i,n="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),o=e.lang.templates,c=e.config;return{title:e.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:o.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+o.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+n+'">'+'<div class="cke_tpl_loading"><span></span></div>'+"</div>"+'<span class="cke_voice_label" id="'+n+'">'+o.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:o.insertOption,"default":c.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var e=this.getContentElement("selectTpl","templatesList");i=e.getElement(),CKEDITOR.loadTemplates(c.templates_files,function(){var a=(c.templates||"default").split(",");a.length?(t(i,a),e.focus()):i.setHtml('<div class="cke_tpl_empty"><span>'+o.emptyListMsg+"</span>"+"</div>")}),this._.element.on("keydown",l)},onHide:function(){this._.element.removeListener("keydown",l)}}})}();