!function(){CKEDITOR.dialog.add("attachment",function(e){function t(e){var t=e.split("/").pop(),a=t.split(".").pop();return{filename:t,className:"attach_"+a}}var a=/^(_(?:self|top|parent|blank))$/,n=function(e,t){var n=t?t.getAttribute("_cke_saved_href")||t.getAttribute("href"):"",l={};if(l.type="url",l.url=n,t){var i=t.getAttribute("target");if(l.target={},i){var r=i.match(a);r?l.target.type=l.target.name=i:(l.target.type="frame",l.target.name=i)}l.title=t.getAttribute("title")}for(var o=e.document.getElementsByTag("img"),g=new CKEDITOR.dom.nodeList(e.document.$.anchors),s=l.anchors=[],m=0;m<o.count();m++){var c=o.getItem(m);c.getAttribute("_cke_realelement")&&"anchor"==c.getAttribute("_cke_real_element_type")&&s.push(e.restoreRealElement(c))}for(m=0;m<g.count();m++)s.push(g.getItem(m));for(m=0;m<s.length;m++)c=s[m],s[m]={name:c.getAttribute("name"),id:c.getAttribute("id")};return this._.selectedElement=t,l},l=function(){var t=this.getDialog(),a=t.getContentElement("general","linkTargetName"),n=this.getValue();a&&(a.setLabel(e.lang.link.targetFrameName),this.getDialog().setValueOf("general","linkTargetName","_"==n.charAt(0)?n:""))};return{title:e.lang.attachment.title,minWidth:420,minHeight:200,onShow:function(){this.fakeObj=!1;var e=this.getParentEditor(),t=e.getSelection(),a=t.getRanges(),l=null;if(1==a.length){var i=a[0].getCommonAncestor(!0);l=i.getAscendant("a",!0),l&&l.getAttribute("href")?t.selectElement(l):(l=i.getAscendant("img",!0))&&l.getAttribute("_cke_real_element_type")&&"anchor"==l.getAttribute("_cke_real_element_type")?(this.fakeObj=l,l=e.restoreRealElement(this.fakeObj),t.selectElement(this.fakeObj)):l=null}this.setupContent(n.apply(this,[e,l]))},onOk:function(){var e={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},a=[],n={href:e.href},l=this.getParentEditor();this.commitContent(n);var i=n.url||"";e._cke_saved_href=0===i.indexOf("/")?i:"http://"+i;var r=t(i);if(n.title||"",e.title=0==n.title.length?r.filename:n.title,e["class"]=r.className,n.target&&("notSet"!=n.target.type&&n.target.name?e.target=n.target.name:a.push("target"),a.push("_cke_pa_onclick","onclick")),this._.selectedElement){var o=this._.selectedElement;if(CKEDITOR.env.ie&&e.name!=o.getAttribute("name")){var g=new CKEDITOR.dom.element('<a name="'+CKEDITOR.tools.htmlEncode(e.name)+'">',l.document);s=l.getSelection(),o.moveChildren(g),o.copyAttributes(g,{name:1}),g.replace(o),o=g,s.selectElement(o)}o.setAttributes(e),o.removeAttributes(a),o.getAttribute("title")&&o.setHtml(o.getAttribute("title")),o.getAttribute("name")?o.addClass("cke_anchor"):o.removeClass("cke_anchor"),this.fakeObj&&l.createFakeElement(o,"cke_anchor","anchor").replace(this.fakeObj),delete this._.selectedElement}else{var s=l.getSelection(),m=s.getRanges();if(1==m.length&&m[0].collapsed){var c=new CKEDITOR.dom.text(e.title,l.document);m[0].insertNode(c),m[0].selectNodeContents(c),s.selectRanges(m)}var u=new CKEDITOR.style({element:"a",attributes:e});u.type=CKEDITOR.STYLE_INLINE,u.apply(l.document)}},contents:[{label:e.lang.common.generalTab,id:"general",accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.attachment.url)+"</span>"},{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"src",type:"text",label:"",validate:CKEDITOR.dialog.validate.notEmpty(e.lang.flash.validateSrc),setup:function(e){e.url&&this.setValue(e.url),this.select()},commit:function(e){e.url=this.getValue()}},{type:"button",id:"browse",filebrowser:"general:src",hidden:!0,align:"center",label:e.lang.common.browseServer}]}]},{type:"vbox",padding:0,children:[{id:"name",type:"text",label:e.lang.attachment.name,setup:function(e){e.title&&this.setValue(e.title)},commit:function(e){e.title=this.getValue()}}]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:e.lang.link.target,"default":"notSet",style:"width : 100%;",items:[[e.lang.link.targetNotSet,"notSet"],[e.lang.link.targetFrame,"frame"],[e.lang.link.targetNew,"_blank"],[e.lang.link.targetTop,"_top"],[e.lang.link.targetSelf,"_self"],[e.lang.link.targetParent,"_parent"]],onChange:l,setup:function(e){e.target&&this.setValue(e.target.type)},commit:function(e){e.target||(e.target={}),e.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:e.lang.link.targetFrameName,"default":"",setup:function(e){e.target&&this.setValue(e.target.name)},commit:function(e){e.target||(e.target={}),e.target.name=this.getValue()}}]}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:e.lang.common.upload,elements:[{type:"file",id:"upload",label:e.lang.common.upload,size:38},{type:"fileButton",id:"uploadButton",label:e.lang.common.uploadSubmit,filebrowser:"general:src","for":["Upload","upload"]}]}]}})}();